
{% extends "base/baseNavbar.html" %}
{% block title %}  {% endblock %}
{% block content %} 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<!--
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css">
-->

<style>
  #calendar a {
  font-size: 1vw;
  font-weight: bold;
  }
</style>


<script>
  
  function createEvent(selectionInfo){
    return {
      title: '{{current_user.email}}',
      start: selectionInfo.start,
      end: selectionInfo.end,
      backgroundColor:'rgb({{current_user.color}})',
      editable: true,
      groupId:'{{current_user.email}}' + Math.random()
    };
  }
  
  function newEvent(selectionInfo){
    event = createEvent(selectionInfo);
    var result=ajaxPostRequest("{{url_for('pages.create_event')}}",event);
    
    if(result['Created']){
      console.log(event);
      return event;
    }else{//TEMPORAL
      return event;
    }
  }

  function changeEvent(info){
    
  }

  function ajaxGetRequest(url,object){
      // Make AJAX request to CreateEvent
      var responseContent;
      $.ajax({
          url: url,  // URL of the route
          type: 'GET',  // HTTP method
          async: false,
          success: function(response) {
            responseContent=response;
          },
          error: function(errorThrown) {
              console.error(errorThrown);
              responseContent=errorThrown;
          }
      });
      console.log(responseContent);
      return responseContent;
    }
  
  function ajaxPostRequest(url,object){
      // Make AJAX request to CreateEvent
      var responseContent;
      $.ajax({
          url: url,  // URL of the route
          contentType: 'application/json',  // content type
          type: 'POST',  // HTTP method
          data: JSON.stringify(object),
          async: false,
          success: function(response){
            responseContent=response;
          },
          error: function(errorThrown){
              console.error(errorThrown);
              responseContent=null;
          }
      });

      console.log(responseContent);
      return responseContent;
    }
  
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      //Aspect ratio
      aspectRatio: 1.5,
      // en catala
      locale: 'ca',
      // See operations and healthchecks of the schedule
      weekends:true,
      firstDay:1,
      allDaySlot:false,
      dayHeaderFormat:{ weekday: 'long' },
      nowIndicator:true,

      // SELECTABLE
      selectable: true,
      selectMirror:true,
      unselectAuto:true,
      selectOverlap:false,
      stickyHeaderDates:true,
      eventOverlap:false,
      //TO BE TESTED

      themeSystem: 'bootstrap5',
      dayMaxEvents: true,
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'timeGridWeek,listWeek'
      },
      events:
        [
        {% for event in all_events %}
          {
            groupId: "{{event.groupId}}",
            title: "{{event.title}}" , 
            start:"{{event.start}}", 
            end:"{{event.end}}",
            editable:{{event.editable}},
            backgroundColor:"rgb({{event.color}})"
          }{% if not loop.last %},{% endif %}
        {% endfor %}
        ],
        
        eventChange: function(info){
          alert('TItle: '+ info.event.title+', Start: '+info.event.start+', End: '+info.event.end)
        },
        eventClick: function(info){
          alert('TItle: '+ info.event.title+', Start: '+info.event.start+', End: '+info.event.end)
        },/*
        eventDrop :function(info){
          alert('TItle: '+ info.event.title+', Start: '+info.event.start+', End: '+info.event.end)
        },*/
        select: function(selectionInfo) {
          //if (
            if(confirm("Est√†s segur que vols fer un booking d'aquestes hores?\n Inici: "+selectionInfo.startStr+' Final:'+selectionInfo.endStr))
            {
              var event = newEvent(selectionInfo);
              console.log(event);
              calendar.addEvent(event);
            }{
              calendar.unselect();
            }
            /*) {
            var newEvent = {
              title: '{{current_user.email}}',
              start: selectionInfo.start,
              end: selectionInfo.end,
              backgroundColor:'rgb({{current_user.color}})',
              editable: true,
              groupId:'{{current_user.email}}'
            };
          } else {
  
          }*/
          // You can create a new event here using start and end times

          
          // Add the new event to the calendar
          
        },
    

      initialView: 'timeGridWeek'
    });
    calendar.render();
  });

</script>


  
      <div class="container-fluid"  >
          <h1 style="display: flex;justify-content: center;">Schedule</h1>
          <div class="row text-center" >
            
            <div class="col-9">
              <div id="calendar" > </div>
            </div>
            <div class="col-3">
              <div id="userConfig" style="margin-bottom:1em;height:350px;overflow:auto;padding:1em;"> 
                <h2 class="text-center">User information {{current_user.email}}</h2>
                <div id="llistaEvents">
                  
                  <div>
                    <span>"User email: {{current_user.email}}"</span>

                  </div>
                  <div>
                    <span>"Hours restants: {{hours}}"</span>

                  </div>
                  



                </div>
            </div>



          </div>


           
  </div>



</div>
{% endblock %}
