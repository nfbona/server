{% extends "base/baseNavbar.html" %}
{% block title %} {% endblock %}
{% block content %} 

<div id="container" class="container-fluid">
  <div class="row">
    <div id="left" class="col">
      <h1>LEFT</h1>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Router</th>
            <th>Time to modify</th>
          </tr>
        </thead>
        <tbody>
          {% for relay in relays %}
          <tr>
            <td>
              <div class="form-check">
                <input id="checkbox{{ relay.id }}" class="form-check-input" type="checkbox" value="{{ relay.id }}" onclick="disableCheckbox(this)">
                <label class="form-check-label" for="checkbox{{ relay.id }}">{{ relay.name }}</label>
              </div>
            </td>
            <td>
              <p style="display:inline;" id="timer{{ relay.id }}"></p>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div id="right" class="col-3">
      <h1>Right</h1>
    </div>
  </div>
</div>

<script>
  var timer = 10;

  function Timer1(relay, time, checkid) {
    let minute = parseInt(time / 60);
    let sec = time % 60;
    document.getElementById(relay).innerHTML = minute + " : " + (sec + 1);
    var name = setInterval(function() {
      document.getElementById(relay).innerHTML = minute + " : " + sec;
      if (sec <= 0) {
        if (minute <= 0) {
          document.getElementById(checkid).disabled = false;
          clearInterval(name);
          return 0;
        } else {
          minute--;
          sec = 60;
        }
      }
      sec--;
    }, 1000);
  };

  function disableCheckbox(checkbox) {
    let aux = "timer" + checkbox.value;
    let checkboxid = "checkbox" + checkbox.value;
    Timer1(aux, timer, checkboxid);
    checkbox.disabled = true;

    // AJAX call to backend
    $.ajax({
      url: "/json",
      type: "POST",
      data: JSON.stringify({
        "id": checkbox.value,
        "value": checkbox.checked
      }),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(data) {
        // console.log(data);
      },
      error: function(xhr, status, error) {
        console.log('Error: ' + error.message);
      }
    });
  }
</script>

{% endblock %}
